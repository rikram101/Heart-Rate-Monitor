<% layout('layouts/bootstrap')%>

<div class="container py-4">
  <div
    class="d-flex justify-content-between align-items-center mb-5 border-bottom pb-3"
  >
    <h1 class="text-primary">Welcome, <b><%= currentUser.name %>!</b></h1>
  </div>

  <h2 class="mb-4 text-secondary">
    <i class="fas fa-users me-2"></i>Patients Under Your Care (<%=
    patients.length %>)
  </h2>

  <% if (patients && patients.length > 0) { %>
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <% for (let patient of patients){%>
    <div class="col">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-success mb-3">
            <i class="fas fa-heartbeat me-2"></i> <%= patient.name %>
          </h5>

          <div class="flex-grow-1 mb-3">
            <h6 class="text-info fw-bold mb-2">7-Day Heart Rate (BPM)</h6>

            <% if (patient.stats) { %>
            <ul class="list-unstyled small text-muted">
              <li>
                <i class="fas fa-chart-bar me-2"></i>
                <strong>Avg:</strong> <%= patient.stats.average.toFixed(1) %>
                BPM
              </li>
              <li>
                <i class="fas fa-arrow-up text-danger me-2"></i>
                <strong>Max:</strong> <%= patient.stats.maximum %> BPM
              </li>
              <li>
                <i class="fas fa-arrow-down text-success me-2"></i>
                <strong>Min:</strong> <%= patient.stats.minimum %> BPM
              </li>
            </ul>
            <% } else { %>
            <p class="text-warning small">
              No heart rate data available for the last 7 days.
            </p>
            <% } %>

            <p class="card-text text-muted small mt-3">
              Patient ID: <%= patient._id %>
            </p>
          </div>
          <a
            href="/patient/devices/<%= patient._id %>"
            class="mt-auto btn btn-primary btn-block"
          >
            <i class="fas fa-chart-line me-2"></i> View Patient Data
          </a>
        </div>
      </div>
    </div>
    <% }%>
  </div>
  <% } else { %>
  <div class="alert alert-info text-center mt-5" role="alert">
    <h4 class="alert-heading">
      <i class="fas fa-info-circle"></i> No Patients Assigned
    </h4>
    <p>You currently do not have any patients linked to your account.</p>
  </div>
  <% } %>
</div>
