<% layout('layouts/bootstrap')%>

<div class="container py-5">
  <div class="row w-100">
    <div class="">
      <div class="card shadow-lg">
        <div class="card-header bg-primary text-white text-center">
          <h1 class="h3 mb-0">Edit Device Settings: <%= device.label %></h1>
        </div>
        <div class="card-body">
          <form
            id="editForm"
            action="/patient/device/<%= device._id %>?_method=PUT"
            method="POST"
            class="validated-form"
            novalidate
          >
            <input type="hidden" name="_method" value="PUT" />

            <h5 class="mt-3 mb-3 border-bottom pb-2 text-secondary">
              Device Hardware Details (Read-Only)
            </h5>

            <div class="mb-3">
              <label class="form-label fw-bold">Hardware ID (Unique)</label>
              <input
                type="text"
                class="form-control bg-secondary-subtle"
                name="device[hardwareId]"
                value="<%= device.hardwareId %>"
                readonly
              />
              <div class="form-text">This unique ID cannot be changed.</div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Model</label>
                <input
                  type="text"
                  class="form-control bg-secondary-subtle"
                  value="<%= device.model %>"
                  readonly
                />
              </div>

              <div class="col-md-6 mb-3">
                <label class="form-label fw-bold">Firmware Version</label>
                <input
                  type="text"
                  class="form-control bg-secondary-subtle"
                  value="<%= device.firmwareVersion || 'N/A' %>"
                  readonly
                />
              </div>
            </div>

            <h5 class="mt-4 mb-3 border-bottom pb-2 text-secondary">
              User Configuration
            </h5>

            <div class="mb-3">
              <label for="label" class="form-label"
                >Device Nickname/Label</label
              >
              <input
                type="text"
                class="form-control"
                id="label"
                name="device[label]"
                value="<%= device.label %>"
                required
              />
            </div>

            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" id="isActive"
              name="device[isActive]" value="true" <%= device.isActive ?
              'checked' : '' %> />
              <label class="form-check-label" for="isActive">
                Device is Active (Check to enable data collection)
              </label>
            </div>

            <h5 class="mt-4 mb-3 border-bottom pb-2 text-secondary">
              Measurement Schedule
            </h5>

            <div class="mb-3">
              <label for="frequency" class="form-label">
                Measurement Frequency (Minutes)
              </label>
              <input
                type="number"
                class="form-control"
                id="frequency"
                name="device[measurementConfig][frequencyMinutes]"
                value="<%= device.measurementConfig.frequencyMinutes %>"
                min="5"
                required
              />
              <div class="form-text">
                The device will request a measurement every N minutes (Min: 5).
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-md-6">
                <label for="startTime" class="form-label">Start Time</label>
                <input
                  type="time"
                  class="form-control"
                  id="startTime"
                  name="device[measurementConfig][startTime]"
                  value="<%= device.measurementConfig.startTime %>"
                  required
                />
                <div class="form-text">
                  Start time for requested daily measurements.
                </div>
              </div>
              <div class="col-md-6">
                <label for="endTime" class="form-label">End Time</label>
                <input
                  type="time"
                  class="form-control"
                  id="endTime"
                  name="device[measurementConfig][endTime]"
                  value="<%= device.measurementConfig.endTime %>"
                  required
                />
                <div class="form-text">
                  End time for requested daily measurements.
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-4">
              <a
                href="/patient/dashboard"
                class="btn btn-outline-secondary btn-lg"
              >
                <i class="fas fa-arrow-left me-2"></i> Back to Dashboard
              </a>
              <button class="btn btn-success btn-lg">
                <i class="fas fa-save me-2"></i> Update Settings
              </button>
            </div>
          </form>

          <hr class="mt-4" />

          <form
            action="/patient/device/<%= device._id %>?_method=DELETE"
            method="POST"
            class="d-inline"
          >
            <button
              class="btn btn-danger w-100"
              onclick="return confirm('Are you sure you want to permanently delete this device? This action cannot be undone.');"
            >
              <i class="fas fa-trash-alt me-2"></i> Delete Device
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
