<% layout('layouts/bootstrap')%>

<div class="container py-4">
  <div
    class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 gap-3"
  >
    <h1 class="text-primary mb-0 text-center text-md-start">
      Hi there, <b><%= currentUser.name %>!</b>
    </h1>

    <a href="/patient/device/new" class="text-decoration-none">
      <button type="button" class="btn btn-success btn-lg shadow-sm">
        <i class="fas fa-plus me-2"></i> Add a New Device
      </button>
    </a>
  </div>

  <hr class="mb-4 text-secondary" />

  <% if (patient_devices && patient_devices.length > 0) { %>
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <% for (let device of patient_devices){%>
    <div class="col">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-header bg-light text-muted small border-bottom-0">
          <i class="fas fa-history me-1"></i>
          Reading every
          <b><%= device.measurementConfig.frequencyMinutes %></b> min
        </div>

        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-primary fw-bold"><%= device.label %></h5>

          <div class="card-text text-secondary mb-4 small">
            <p class="mb-1">
              <strong>Device ID:</strong> <%= device.hardwareId %>
            </p>
            <p class="mb-0"><strong>Model:</strong> <%= device.model %></p>
          </div>

          <div class="mt-auto d-grid gap-2">
            <a
              href="/patient/readings/<%= device._id %>"
              class="btn btn-primary"
            >
              View Data
            </a>
            <a
              href="/patient/device/<%= device._id %>/edit"
              class="btn btn-outline-secondary"
            >
              Edit Settings
            </a>
          </div>
        </div>
      </div>
    </div>
    <% }%>
  </div>
  <% } else { %>
  <div class="alert alert-info text-center mt-4" role="alert">
    You haven't added any devices yet. Click the button above to get started!
  </div>
  <% } %>
</div>
